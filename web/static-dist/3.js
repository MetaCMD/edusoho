(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{107:function(e,t,n){e.exports=n(358)},1387:function(e,t,n){},1388:function(e,t,n){e.exports=function(e,t){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=n(e),a=n(t);function i(...e){class t{constructor(){for(let t of e)s(this,new t)}}for(let n of e)s(t,n),s(t.prototype,n.prototype);return t}function s(e,t){for(let n of Reflect.ownKeys(t))if("constructor"!==n&&"prototype"!==n&&"name"!==n){let r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r)}}class o extends(i(r.default,a.default)){}return o}(n(68),n(1391))},1389:function(e,t,n){"use strict";var r={name:"AsideLayout",props:{breadcrumbs:{type:Array,required:!0}}},a=(n(1390),n(30)),i=Object(a.a)(r,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"aside-layout"},[n("div",{staticClass:"aside-layout-header"},[n("a-breadcrumb",{staticClass:"pull-left",attrs:{separator:"/"}},e._l(e.breadcrumbs,(function(t,r){return n("a-breadcrumb-item",{key:r},[t.href?[n("a",{attrs:{href:t.href,target:"_blank"}},[e._v(e._s(t.name))])]:t.pathName?[n("a",{attrs:{href:"javascript:;"},on:{click:function(n){return e.$router.push({name:t.pathName})}}},[e._v(e._s(t.name))])]:[e._v("\n          "+e._s(t.name)+"\n        ")]],2)})),1)],1),e._v(" "),n("div",{staticClass:"aside-layout-main"},[e._t("default")],2)])}),[],!1,null,null,null);t.a=i.exports},1390:function(e,t,n){"use strict";var r=n(1387);n.n(r).a},1391:function(e,t,n){e.exports=function(){"use strict";var e="millisecond",t="second",n="minute",r="hour",a="day",i="week",s="month",o="quarter",c="year",l="date",u=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[^0-9]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,d=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,h={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},f=function(e,t,n){var r=String(e);return!r||r.length>=t?e:""+Array(t+1-r.length).join(n)+e},p={s:f,z:function(e){var t=-e.utcOffset(),n=Math.abs(t),r=Math.floor(n/60),a=n%60;return(t<=0?"+":"-")+f(r,2,"0")+":"+f(a,2,"0")},m:function e(t,n){if(t.date()<n.date())return-e(n,t);var r=12*(n.year()-t.year())+(n.month()-t.month()),a=t.clone().add(r,s),i=n-a<0,o=t.clone().add(r+(i?-1:1),s);return+(-(r+(n-a)/(i?a-o:o-a))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(u){return{M:s,y:c,w:i,d:a,D:l,h:r,m:n,s:t,ms:e,Q:o}[u]||String(u||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},m="en",v={};v[m]=h;var y=function(e){return e instanceof D},g=function(e,t,n){var r;if(!e)return m;if("string"==typeof e)v[e]&&(r=e),t&&(v[e]=t,r=e);else{var a=e.name;v[a]=e,r=a}return!n&&r&&(m=r),r||!n&&m},_=function(e,t){if(y(e))return e.clone();var n="object"==typeof t?t:{};return n.date=e,n.args=arguments,new D(n)},b=p;b.l=g,b.i=y,b.w=function(e,t){return _(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var D=function(){function h(e){this.$L=g(e.locale,null,!0),this.parse(e)}var f=h.prototype;return f.parse=function(e){this.$d=function(e){var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(b.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var r=t.match(u);if(r){var a=r[2]-1||0,i=(r[7]||"0").substring(0,3);return n?new Date(Date.UTC(r[1],a,r[3]||1,r[4]||0,r[5]||0,r[6]||0,i)):new Date(r[1],a,r[3]||1,r[4]||0,r[5]||0,r[6]||0,i)}}return new Date(t)}(e),this.$x=e.x||{},this.init()},f.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},f.$utils=function(){return b},f.isValid=function(){return!("Invalid Date"===this.$d.toString())},f.isSame=function(e,t){var n=_(e);return this.startOf(t)<=n&&n<=this.endOf(t)},f.isAfter=function(e,t){return _(e)<this.startOf(t)},f.isBefore=function(e,t){return this.endOf(t)<_(e)},f.$g=function(e,t,n){return b.u(e)?this[t]:this.set(n,e)},f.unix=function(){return Math.floor(this.valueOf()/1e3)},f.valueOf=function(){return this.$d.getTime()},f.startOf=function(e,o){var u=this,d=!!b.u(o)||o,h=b.p(e),f=function(e,t){var n=b.w(u.$u?Date.UTC(u.$y,t,e):new Date(u.$y,t,e),u);return d?n:n.endOf(a)},p=function(e,t){return b.w(u.toDate()[e].apply(u.toDate("s"),(d?[0,0,0,0]:[23,59,59,999]).slice(t)),u)},m=this.$W,v=this.$M,y=this.$D,g="set"+(this.$u?"UTC":"");switch(h){case c:return d?f(1,0):f(31,11);case s:return d?f(1,v):f(0,v+1);case i:var _=this.$locale().weekStart||0,D=(m<_?m+7:m)-_;return f(d?y-D:y+(6-D),v);case a:case l:return p(g+"Hours",0);case r:return p(g+"Minutes",1);case n:return p(g+"Seconds",2);case t:return p(g+"Milliseconds",3);default:return this.clone()}},f.endOf=function(e){return this.startOf(e,!1)},f.$set=function(i,o){var u,d=b.p(i),h="set"+(this.$u?"UTC":""),f=(u={},u[a]=h+"Date",u[l]=h+"Date",u[s]=h+"Month",u[c]=h+"FullYear",u[r]=h+"Hours",u[n]=h+"Minutes",u[t]=h+"Seconds",u[e]=h+"Milliseconds",u)[d],p=d===a?this.$D+(o-this.$W):o;if(d===s||d===c){var m=this.clone().set(l,1);m.$d[f](p),m.init(),this.$d=m.set(l,Math.min(this.$D,m.daysInMonth())).$d}else f&&this.$d[f](p);return this.init(),this},f.set=function(e,t){return this.clone().$set(e,t)},f.get=function(e){return this[b.p(e)]()},f.add=function(e,o){var l,u=this;e=Number(e);var d=b.p(o),h=function(t){var n=_(u);return b.w(n.date(n.date()+Math.round(t*e)),u)};if(d===s)return this.set(s,this.$M+e);if(d===c)return this.set(c,this.$y+e);if(d===a)return h(1);if(d===i)return h(7);var f=(l={},l[n]=6e4,l[r]=36e5,l[t]=1e3,l)[d]||1,p=this.$d.getTime()+e*f;return b.w(p,this)},f.subtract=function(e,t){return this.add(-1*e,t)},f.format=function(e){var t=this;if(!this.isValid())return"Invalid Date";var n=e||"YYYY-MM-DDTHH:mm:ssZ",r=b.z(this),a=this.$locale(),i=this.$H,s=this.$m,o=this.$M,c=a.weekdays,l=a.months,u=function(e,r,a,i){return e&&(e[r]||e(t,n))||a[r].substr(0,i)},h=function(e){return b.s(i%12||12,e,"0")},f=a.meridiem||function(e,t,n){var r=e<12?"AM":"PM";return n?r.toLowerCase():r},p={YY:String(this.$y).slice(-2),YYYY:this.$y,M:o+1,MM:b.s(o+1,2,"0"),MMM:u(a.monthsShort,o,l,3),MMMM:u(l,o),D:this.$D,DD:b.s(this.$D,2,"0"),d:String(this.$W),dd:u(a.weekdaysMin,this.$W,c,2),ddd:u(a.weekdaysShort,this.$W,c,3),dddd:c[this.$W],H:String(i),HH:b.s(i,2,"0"),h:h(1),hh:h(2),a:f(i,s,!0),A:f(i,s,!1),m:String(s),mm:b.s(s,2,"0"),s:String(this.$s),ss:b.s(this.$s,2,"0"),SSS:b.s(this.$ms,3,"0"),Z:r};return n.replace(d,(function(e,t){return t||p[e]||r.replace(":","")}))},f.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},f.diff=function(e,l,u){var d,h=b.p(l),f=_(e),p=6e4*(f.utcOffset()-this.utcOffset()),m=this-f,v=b.m(this,f);return v=(d={},d[c]=v/12,d[s]=v,d[o]=v/3,d[i]=(m-p)/6048e5,d[a]=(m-p)/864e5,d[r]=m/36e5,d[n]=m/6e4,d[t]=m/1e3,d)[h]||m,u?v:b.a(v)},f.daysInMonth=function(){return this.endOf(s).$D},f.$locale=function(){return v[this.$L]},f.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),r=g(e,t,!0);return r&&(n.$L=r),n},f.clone=function(){return b.w(this.$d,this)},f.toDate=function(){return new Date(this.valueOf())},f.toJSON=function(){return this.isValid()?this.toISOString():null},f.toISOString=function(){return this.$d.toISOString()},f.toString=function(){return this.$d.toUTCString()},h}(),k=D.prototype;return _.prototype=k,[["$ms",e],["$s",t],["$m",n],["$H",r],["$W",a],["$M",s],["$y",c],["$D",l]].forEach((function(e){k[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),_.extend=function(e,t){return e.$i||(e(t,D,_),e.$i=!0),_},_.locale=g,_.isDayjs=y,_.unix=function(e){return _(1e3*e)},_.en=v[m],_.Ls=v,_.p={},_}()},1393:function(e,t,n){},1399:function(e,t,n){"use strict";var r=n(1393);n.n(r).a},1401:function(e,t,n){},1402:function(e,t,n){},1411:function(e,t,n){"use strict";var r={name:"Empty",props:{description:{type:String,default:"暂无数据"},image:{type:String,default:"/static-dist/app/img/vue/empty.png"},imageStyle:{type:Object,default:function(){return{height:"200px"}}}}},a=(n(1399),n(30)),i=Object(a.a)(r,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a-empty",{staticClass:"custom-empty",attrs:{image:e.image,"image-style":e.imageStyle}},[n("span",{staticClass:"custom-empty__description",attrs:{slot:"description"},slot:"description"},[e._v(e._s(e.description))])])}),[],!1,null,null,null);t.a=i.exports},1413:function(e,t,n){"use strict";var r=n(29),a=n.n(r),i=n(43),s=n.n(i),o=n(376),c=n.n(o),l=n(553),u=n(1388),d=n.n(u),h={name:"LessonDirectoryItem",props:{lesson:{type:Object,required:!0},className:{type:String,required:!0},courseId:{type:[Number,String],required:!0}},computed:{getTitle:function(){var e=this.lesson,t=e.type,n=e.title,r=e.number;return"chapter"===t?"第".concat(r,"章 ").concat(n):"unit"===t?"第".concat(r,"节 ").concat(n):"lesson"===t?"课时".concat(r," ").concat(n):"任务".concat(r," ").concat(n)},getStartTime:function(){var e=this.lessonData,t=e.type,n=e.startTime;return"live"===t?this.$dateFormat(n,"YYYY/MM/DD HH:mm:ss"):"- -"},getLength:function(){var e=this.lessonData,t=e.type,n=e.length;return"live"===t?"".concat(n," 分钟"):"- -"},isOnlyOneTask:function(){return this.lesson.tasks&&1==this.lesson.tasks.length},lessonData:function(){return this.isOnlyOneTask?this.lesson.tasks[0]:this.lesson}},methods:{handleDeleteClick:function(){var e=this.lessonData,t=e.type,n=e.id,r=this;this.$confirm({content:"确认删除?",okType:"danger",icon:"close-circle",maskClosable:!0,onOk:function(){r.$emit("event-communication",{eventType:["chapter","unit"].includes(t)?"deleteChapterUnit":"deleteTask",id:n})}})},handleEditorClick:function(){var e=this.lessonData,t=e.type,n=e.id,r=e.title;this.$emit("event-communication",{eventType:"renameChapterUnit",id:n,type:t,title:r})}}},f=(n(1417),n(30)),p={name:"LessonDirectory",components:{LessonDirectoryItem:Object(f.a)(h,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:"lesson-directory-"+e.className+" clearfix"},[n("div",{staticClass:"title pull-left text-overflow"},[e.lessonData.mode&&"live"!==e.lessonData.type?n("a-tag",[e._v("非直播")]):e._e(),e._v(" "),e.lessonData.mode&&"published"!==e.lessonData.status?n("a-tag",[e._v("未发布")]):e._e(),e._v("\n    "+e._s(e.getTitle)+"\n  ")],1),e._v(" "),n("div",{staticClass:"start-time pull-left"},[e._v(e._s(e.getStartTime))]),e._v(" "),n("div",{staticClass:"duration pull-left"},[e._v(e._s(e.getLength))]),e._v(" "),n("div",{staticClass:"actions pull-left"},[n("a-space",{attrs:{size:"large"}},[e.lessonData.mode&&e.isPermission("course_lesson_manage")?n("a-icon",{staticStyle:{color:"#46c37b"},attrs:{type:"edit","data-toggle":"modal","data-target":"#modal","data-url":"/course/"+e.courseId+"/task/"+e.lessonData.id+"/update"}}):e._e(),e._v(" "),["chapter","unit"].includes(e.lessonData.type)?n("a-icon",{staticStyle:{color:"#46c37b"},attrs:{type:"edit"},on:{click:e.handleEditorClick}}):e._e(),e._v(" "),"lesson"!==e.lessonData.type&&"published"!==e.lessonData.status&&e.isPermission("course_lesson_manage")?n("a-icon",{staticStyle:{color:"#fe4040"},attrs:{type:"delete"},on:{click:e.handleDeleteClick}}):e._e()],1)],1)])}),[],!1,null,null,null).exports,Empty:n(1411).a},props:{courseId:{type:[Number,String],required:!0},lessonDirectory:{type:Array,required:!0}},methods:{allowDrag:function(e,t,n){if(!["chapter","unit","lesson"].includes(e))return!1;if("chapter"===e&&"chapter"===t&&0!=n)return!0;if("unit"===e){if("chapter"===t)return!0;if("unit"===t&&0!=n)return!0}if("lesson"===e){if(["chapter","unit"].includes(t))return!0;if("lesson"===t&&0!=n)return!0}return!1},onDrop:function(e){var t,n,r,a,i,s,o=e.node.eventKey,l=e.dragNode.eventKey,u=e.node.pos.split("-"),d=e.dropPosition-Number(u[u.length-1]),h=function e(t,n,r){t.forEach((function(t,a,i){return t.id===n?r(t,a,i):t.children?e(t.children,n,r):t.tasks?e(t.tasks,n,r):void 0}))},f=c()(this.lessonDirectory);h(f,l,(function(e,a,i){t=e,n=a,r=i})),h(f,o,(function(e,t,n){a=e,i=t,s=n})),this.allowDrag(t.type,a.type,d)&&(r.splice(n,1),e.dropToGap?(e.node.children||[]).length>0&&e.node.expanded&&1===d?(a.children=a.children||[],a.children.unshift(t)):-1===d?s.splice(i,0,t):s.splice(i+1,0,t):(a.children=a.children||[],a.children.push(t)),this.$emit("change-lesson-directory",{data:f}))},eventCommunication:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.eventType,n=e.id;"renameChapterUnit"!==t?"deleteChapterUnit"!==t?"deleteTask"===t&&this.deleteTask(n):this.deleteChapter(n):this.renameChapterUnit(e)},renameChapterUnit:function(e){this.$emit("change-lesson-directory",e)},deleteChapter:function(e){var t=this;return s()(a.a.mark((function n(){var r;return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,l.c.deleteChapter(t.courseId,e);case 2:r=n.sent,r.success&&(t.$emit("change-lesson-directory",{eventType:"update"}),t.$message.success("删除成功"));case 5:case"end":return n.stop()}}),n)})))()},deleteTask:function(e){var t=this;return s()(a.a.mark((function n(){return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,l.c.deleteTask(t.courseId,e);case 2:n.sent&&(t.$emit("change-lesson-directory",{eventType:"update"}),t.$message.success("删除成功"));case 4:case"end":return n.stop()}}),n)})))()}}},m=(n(1418),Object(f.a)(p,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"lesson-directory"},[e._m(0),e._v(" "),n("a-tree",{staticClass:"lesson-directory-tree",attrs:{draggable:"",blockNode:!0},on:{drop:e.onDrop}},[n("a-icon",{attrs:{slot:"switcherIcon",type:"down"},slot:"switcherIcon"}),e._v(" "),e._l(e.lessonDirectory,(function(t){return[n("a-tree-node",{key:t.id,class:"tree-node-"+t.type},[n("template",{slot:"title"},[n("lesson-directory-item",{attrs:{courseId:e.courseId,lesson:t,"class-name":"first"},on:{"event-communication":e.eventCommunication}})],1),e._v(" "),t.children?[e._l(t.children,(function(t){return[n("a-tree-node",{key:t.id,class:"tree-node-"+t.type},[n("template",{slot:"title"},[n("lesson-directory-item",{attrs:{courseId:e.courseId,lesson:t,"class-name":"second"},on:{"event-communication":e.eventCommunication}})],1),e._v(" "),t.children?[e._l(t.children,(function(t){return[n("a-tree-node",{key:t.id,class:"tree-node-"+t.type},[n("template",{slot:"title"},[n("lesson-directory-item",{attrs:{courseId:e.courseId,lesson:t,"class-name":"third"},on:{"event-communication":e.eventCommunication}})],1),e._v(" "),t.tasks&&t.tasks.length>1?[e._l(t.tasks,(function(t){return[n("a-tree-node",{key:t.id,staticClass:"tree-node-task"},[n("template",{slot:"title"},[n("lesson-directory-item",{attrs:{courseId:e.courseId,lesson:t,"class-name":"four"},on:{"event-communication":e.eventCommunication}})],1)],2)]}))]:e._e()],2)]}))]:e._e(),e._v(" "),t.tasks&&t.tasks.length>1?[e._l(t.tasks,(function(t){return[n("a-tree-node",{key:t.id,staticClass:"tree-node-task"},[n("template",{slot:"title"},[n("lesson-directory-item",{attrs:{courseId:e.courseId,lesson:t,"class-name":"third"},on:{"event-communication":e.eventCommunication}})],1)],2)]}))]:e._e()],2)]}))]:e._e(),e._v(" "),t.tasks&&t.tasks.length>1?[e._l(t.tasks,(function(t){return[n("a-tree-node",{key:t.id,staticClass:"tree-node-task"},[n("template",{slot:"title"},[n("lesson-directory-item",{attrs:{courseId:e.courseId,lesson:t,"class-name":"second"},on:{"event-communication":e.eventCommunication}})],1)],2)]}))]:e._e()],2)]}))],2),e._v(" "),e.lessonDirectory.length?e._e():n("empty")],1)}),[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"clearfix lesson-directory__header"},[n("div",{staticClass:"pull-left title"},[e._v("课时")]),e._v(" "),n("div",{staticClass:"pull-left start-time"},[e._v("开始时间")]),e._v(" "),n("div",{staticClass:"pull-left duration"},[e._v("持续时间")])])}],!1,null,null,null).exports),v=n(130),y=n.n(v),g=n(107),b=n.n(g),D=n(81),k=n.n(D),C=n(74),w=n.n(C),O=n(82),S=n.n(O),x=n(47),M=n.n(x),I=n(39),T=n.n(I);function L(e,t){var n=M()(e);if(S.a){var r=S()(e);t&&(r=r.filter((function(t){return w()(e,t).enumerable}))),n.push.apply(n,r)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){T()(e,t,n[t])})):k.a?b()(e,k()(n)):L(Object(n)).forEach((function(t){y()(e,t,w()(n,t))}))}return e}var N=[{label:"周一",value:"Monday"},{label:"周二",value:"Tuesday"},{label:"周三",value:"Wednesday"},{label:"周四",value:"Thursday"},{label:"周五",value:"Friday"},{label:"周六",value:"Saturday"},{label:"周日",value:"Sunday"}],U=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],A={name:"CreateLiveModal",props:{visible:{type:Boolean,required:!0,default:!1},courseId:{type:[Number,String],required:!0,default:0}},data:function(){return{confirmLoading:!1,form:this.$form.createForm(this,{name:"create_live"}),createMode:!1,repeatType:"day",checkedList:[],indeterminate:!1,checkAll:!1,repeatDataOptions:N,startDate:"",repeatData:1}},computed:{getRepeatDataTip:function(){var e=moment(this.startDate).format("YYYY-MM-DD"),t={Monday:"周一",Tuesday:"周二",Wednesday:"周三",Thursday:"周四",Friday:"周五",Saturday:"周六",Sunday:"周日"};return"day"===this.repeatType?"从 ".concat(e," 所开始，每 ").concat(this.repeatData," 天有课"):"从 ".concat(e," 所处周开始，每 ").concat(d.a.join(d.a.map(this.repeatData,(function(e){return t[e]})),"、")," 有课")}},mounted:function(){this.startDate=this.form.getFieldValue("startDate")},methods:{moment:moment,onChangeCreateMode:function(e){this.createMode=e},onChangeRepeatType:function(e){this.form.resetFields(["repeatData"]);var t=e.target.value;this.repeatType=t,this.repeatData="day"==t?1:this.checkedList},onChangeCheckedList:function(e){d.a.assign(this,{checkedList:e,indeterminate:!!e.length&&e.length<N.length,checkAll:e.length===N.length,repeatData:e})},onCheckAllChange:function(e){var t=e.target.checked?U:[];this.form.setFieldsValue(T()({},"repeatData",t)),d.a.assign(this,{checkedList:t,indeterminate:!1,checkAll:e.target.checked,repeatData:t})},validatorTaskNum:d.a.debounce((function(e,t,n){t>50?n("一次批量生成最大为50个课时"):n()}),300),onChangeStartDate:function(e,t){this.startDate=e},onChangeRepeatData:function(e){this.repeatData=e},validatorStartDate:d.a.debounce((function(e,t,n){t._d<=moment()?n("开始时间不能小于当前时间"):n()}),300),range:function(e,t){for(var n=[],r=e;r<t;r++)n.push(r);return n},disabledDate:function(e){return e&&e<moment().startOf("day")},createTask:function(e){var t=this;return s()(a.a.mark((function n(){var r,i;return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,t.confirmLoading=!0,n.next=4,l.c.addLiveTask(t.courseId,e);case 4:r=n.sent,i=r.data,t.$emit("change-lesson-directory",{addData:i}),t.handleCancel();case 8:return n.prev=8,t.confirmLoading=!1,n.finish(8);case 11:case"end":return n.stop()}}),n,null,[[0,,8,11]])})))()},batchCreation:function(e){var t=this;return s()(a.a.mark((function n(){var r,i,s,o,c;return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=[],i=e.taskNum,s=d.a.floor(i/5),i%5!=0&&s++,n.prev=4,t.confirmLoading=!0,o=0;case 7:if(!(o<s)){n.next=15;break}return n.next=10,l.c.addLiveTask(t.courseId,j(j({},e),{start:5*o,limit:5}));case 10:c=n.sent,d.a.forEach(c.data,(function(e){r.push(e)}));case 12:o++,n.next=7;break;case 15:t.$emit("change-lesson-directory",{addData:r}),t.handleCancel();case 17:return n.prev=17,t.confirmLoading=!1,n.finish(17);case 20:case"end":return n.stop()}}),n,null,[[4,,17,20]])})))()},handleOk:function(){var e=this;this.form.validateFields((function(t,n){if(!t)if(n.startDate=n.startDate._d,e.createMode){e.handleCancel();var r=e;e.$confirm({title:"提醒",content:"确定批量新增 ".concat(n.taskNum," 个直播课时吗?"),onOk:function(){r.batchCreation(n)},onCancel:function(){r.handleCancel(!0)}})}else e.createTask(n)}))},handleCancel:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$emit("handle-cancel",e)}}},q=Object(f.a)(A,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a-modal",{attrs:{title:"添加直播课时",visible:e.visible,"confirm-loading":e.confirmLoading,"ok-text":"确认","cancel-text":"取消",width:"900px"},on:{ok:e.handleOk,cancel:function(t){return e.handleCancel(!1)}}},[n("a-form",{attrs:{form:e.form}},[n("a-form-item",{attrs:{label:"课时名称","label-col":{span:3},"wrapper-col":{span:21}}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["title",{rules:[{required:!0,message:"请填写课时名称"},{max:40,message:"最长 40 个字符"}]}],expression:"['title', { rules: [\n          { required: true, message: '请填写课时名称' },\n          { max: 40, message: '最长 40 个字符' }\n        ]}]"}],attrs:{placeholder:"请输入课时名称"}})],1),e._v(" "),n("a-form-item",{attrs:{label:"批量生成","label-col":{span:3},"wrapper-col":{span:21}}},[n("a-switch",{attrs:{checked:e.createMode},on:{change:e.onChangeCreateMode}})],1),e._v(" "),e.createMode?n("a-form-item",{attrs:{label:"课时数量","label-col":{span:3},"wrapper-col":{span:21}}},[n("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["taskNum",{rules:[{required:!0,message:"请输入批量生成课时数量"},{validator:e.validatorTaskNum}]}],expression:"['taskNum', { rules: [\n          { required: true, message: '请输入批量生成课时数量' },\n          { validator: validatorTaskNum }\n        ]}]"}],staticStyle:{width:"100%"},attrs:{min:1,placeholder:"请输入课时数量"}})],1):e._e(),e._v(" "),n("a-form-item",{attrs:{label:"开始日期","label-col":{span:3},"wrapper-col":{span:21}}},[n("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["startDate",{initialValue:e.moment().add(5,"minutes"),rules:[{type:"object",required:!0,message:"日期时间不能为空"},{validator:e.validatorStartDate}]}],expression:"['startDate', {\n          initialValue: moment().add(5, 'minutes'),\n          rules: [\n            { type: 'object', required: true, message: '日期时间不能为空' },\n            { validator: validatorStartDate }\n          ]\n        }]"}],attrs:{"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","disabled-date":e.disabledDate,placeholder:"请选择日期时间"},on:{change:e.onChangeStartDate}})],1),e._v(" "),n("a-form-item",{attrs:{label:"上课时长","label-col":{span:3},"wrapper-col":{span:21}}},[n("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["length",{initialValue:60,rules:[{required:!0,message:"上课时长不能为空"}]}],expression:"['length', {\n          initialValue: 60,\n          rules: [{ required: true, message: '上课时长不能为空' }\n        ]}]"}],attrs:{placeholder:"选择上课时长"}},e._l(10,(function(t){return n("a-select-option",{key:"length"+t,attrs:{value:30*t}},[e._v(e._s(30*t)+" 分钟")])})),1)],1),e._v(" "),e.createMode?n("a-form-item",{attrs:{label:"重复方式","label-col":{span:3},"wrapper-col":{span:21}}},[n("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["repeatType",{initialValue:"day"}],expression:"['repeatType', { initialValue: 'day' }]"}],on:{change:e.onChangeRepeatType}},[n("a-radio",{attrs:{value:"day"}},[e._v("\n          按天重复\n        ")]),e._v(" "),n("a-radio",{attrs:{value:"week"}},[e._v("\n          按周重复\n        ")])],1)],1):e._e(),e._v(" "),e.createMode?n("a-form-item",{attrs:{label:"day"===e.repeatType?"按天重复":"每周重复","label-col":{span:3},"wrapper-col":{span:21}}},["day"===e.repeatType?[n("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["repeatData",{initialValue:1}],expression:"['repeatData', { initialValue: 1 }]"}],attrs:{placeholder:"选择上课时长"},on:{change:e.onChangeRepeatData}},e._l(6,(function(t){return n("a-select-option",{key:t,attrs:{value:t}},[e._v("\n            每 "+e._s(t)+" 天一次课\n          ")])})),1)]:[n("a-checkbox",{attrs:{indeterminate:e.indeterminate,checked:e.checkAll},on:{change:e.onCheckAllChange}},[e._v("全选")]),e._v(" "),n("a-checkbox-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["repeatData",{initialValue:e.checkedList,rules:[{required:!0,message:"请选择每周重复天数"}]}],expression:"['repeatData', {\n            initialValue: checkedList,\n            rules: [{ required: true, message: '请选择每周重复天数' }]\n          }]"}],attrs:{options:e.repeatDataOptions},on:{change:e.onChangeCheckedList}})],e._v(" "),"day"===e.repeatType||"week"===e.repeatType&&e.repeatData.length?n("div",[n("a-icon",{staticStyle:{color:"#fe4040"},attrs:{type:"exclamation-circle"}}),e._v("\n        "+e._s(e.getRepeatDataTip)+"\n      ")],1):e._e()],2):e._e()],1)],1)}),[],!1,null,null,null).exports,V={name:"AddChapterOrUnitModal",props:{visible:{type:Boolean,required:!0},chapterUnitInfo:{type:Object,required:!0},type:String,courseId:{type:[Number,String],required:!0}},data:function(){return{form:this.$form.createForm(this,{name:"add_chapter_or_unit"})}},computed:{modalInfo:function(){var e={chapter:"章",unit:"节"}[this.type];return{title:"".concat(this.isEditor?"编辑":"创建"," ").concat(e),label:"".concat(e," 标题")}},isEditor:function(){return!!d.a.size(this.chapterUnitInfo)}},methods:{handleOk:function(){var e=this;this.form.validateFields((function(t,n){if(!t){var r={type:e.type,title:n.title};e.isEditor?l.c.editorChapter(e.courseId,e.chapterUnitInfo.id,r).then((function(t){e.$emit("change-lesson-directory",{eventType:"update"}),e.handleCancel()})):l.c.addChapter(e.courseId,r).then((function(t){e.$emit("change-lesson-directory",{addData:[t]}),e.handleCancel()}))}}))},handleCancel:function(){this.$emit("handle-cancel"),this.form.resetFields()}}},Y={name:"Schedule",components:{LessonDirectory:m,CreateLiveModal:q,AddChapterOrUnitModal:Object(f.a)(V,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a-modal",{attrs:{title:e.modalInfo.title,visible:e.visible,okText:e.isEditor?"保存":"新增一栏"},on:{ok:e.handleOk,cancel:e.handleCancel}},[n("a-form",{attrs:{form:e.form}},[n("a-form-item",{attrs:{label:e.modalInfo.label,"label-col":{span:5},"wrapper-col":{span:16}}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["title",{initialValue:e.chapterUnitInfo.title,rules:[{required:!0,message:"标题不能为空"}]}],expression:"['title', {\n          initialValue: chapterUnitInfo.title,\n          rules: [{ required: true, message: '标题不能为空' }]\n        }]"}]})],1)],1)],1)}),[],!1,null,null,null).exports},props:{courseId:{type:[Number,String],required:!0},courseSetId:{type:[Number,String],required:!0}},data:function(){return{lessonDirectory:[],createLiveVisible:!1,addChapterOrUnitVisible:!1,addType:"",chapterUnitInfo:{}}},watch:{courseId:function(e,t){this.fetchCourseLesson(e)}},created:function(){this.fetchCourseLesson()},mounted:function(){var e=this;$("#modal").on("hide.bs.modal",(function(){e.fetchCourseLesson()}))},methods:{fetchCourseLesson:function(){var e=this;this.courseId&&l.c.getCourseLesson(this.courseId,{format:1}).then((function(t){e.lessonDirectory=t}))},showCreateLiveModal:function(){this.createLiveVisible=!0},hideCreateLiveModal:function(e){this.createLiveVisible=e},changeLessonDirectory:function(e){var t=this,n=e.data,r=void 0===n?this.lessonDirectory:n,a=e.addData,i=e.eventType,s=e.type;if("renameChapterUnit"===i)return this.chapterUnitInfo=e,void this.showAddChapterOrUnitModal({key:s});if("update"!==i){var o=[],c=function e(t,n){_.forEach(n,(function(n){var r=n.type,a=n.id;t.push("".concat(r,"-").concat(a)),n.children&&e(t,n.children)}))};c(o,r),a&&c(o,a),l.c.courseSort(this.courseId,{sortInfos:o}).then((function(e){t.fetchCourseLesson()}))}else this.fetchCourseLesson()},showAddChapterOrUnitModal:function(e){var t=e.key;this.addChapterOrUnitVisible=!0,this.addType=t},hideAddChapterOrUnitModal:function(){this.addChapterOrUnitVisible=!1,this.chapterUnitInfo={}}}},E=Object(f.a)(Y,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e.isPermission("course_lesson_manage")?n("div",[n("a-icon",{staticStyle:{color:"#bebebe"},attrs:{type:"exclamation-circle"}}),e._v("\n    排课只涉及直播课时，其他类型课时设置，请点击-"),n("a",{attrs:{href:e.courseSetId?"/course_set/"+e.courseSetId+"/manage/course/"+e.courseId+"/tasks":"javascript:;",target:e.courseSetId?"_blank":""}},[e._v("更多课时设置")])],1):e._e(),e._v(" "),n("div",{staticClass:"clearfix"},[n("a-space",{attrs:{size:"large"}},[e.isPermission("course_lesson_manage")?n("a-button",{attrs:{type:"primary",disabled:0==e.courseId},on:{click:e.showCreateLiveModal}},[n("a-icon",{attrs:{type:"plus"}}),e._v("\n        添加直播课时\n      ")],1):e._e(),e._v(" "),n("a-dropdown",{attrs:{disabled:0==e.courseId,trigger:["click"]}},[n("a-button",{attrs:{type:"primary"}},[n("a-icon",{attrs:{type:"plus"}}),e._v("\n          章/节\n        ")],1),e._v(" "),n("a-menu",{attrs:{slot:"overlay"},on:{click:e.showAddChapterOrUnitModal},slot:"overlay"},[n("a-menu-item",{key:"chapter"},[e._v("添加章")]),e._v(" "),n("a-menu-item",{key:"unit"},[e._v("添加节")])],1)],1)],1),e._v(" "),e._e()],1),e._v(" "),n("lesson-directory",{attrs:{courseId:e.courseId,"lesson-directory":e.lessonDirectory},on:{"change-lesson-directory":e.changeLessonDirectory}}),e._v(" "),n("create-live-modal",{attrs:{courseId:e.courseId,visible:e.createLiveVisible},on:{"handle-cancel":e.hideCreateLiveModal,"change-lesson-directory":e.changeLessonDirectory}}),e._v(" "),n("add-chapter-or-unit-modal",{attrs:{type:e.addType,courseId:e.courseId,visible:e.addChapterOrUnitVisible,"chapter-unit-info":e.chapterUnitInfo},on:{"handle-cancel":e.hideAddChapterOrUnitModal,"change-lesson-directory":e.changeLessonDirectory}})],1)}),[],!1,null,null,null);t.a=E.exports},1417:function(e,t,n){"use strict";var r=n(1401);n.n(r).a},1418:function(e,t,n){"use strict";var r=n(1402);n.n(r).a},142:function(e,t,n){e.exports=n(566)},196:function(e,t,n){e.exports=n(562)},224:function(e,t,n){n(225);var r=n(51).Object;e.exports=function(e,t){return r.getOwnPropertyDescriptor(e,t)}},225:function(e,t,n){var r=n(137),a=n(185).f;n(357)("getOwnPropertyDescriptor",(function(){return function(e,t){return a(r(e),t)}}))},357:function(e,t,n){var r=n(76),a=n(51),i=n(326);e.exports=function(e,t){var n=(a.Object||{})[e]||Object[e],s={};s[e]=t(n),r(r.S+r.F*i((function(){n(1)})),"Object",s)}},358:function(e,t,n){n(359);var r=n(51).Object;e.exports=function(e,t){return r.defineProperties(e,t)}},359:function(e,t,n){var r=n(76);r(r.S+r.F*!n(143),"Object",{defineProperties:n(408)})},360:function(e,t,n){n(361),e.exports=n(51).Object.getOwnPropertyDescriptors},361:function(e,t,n){var r=n(76),a=n(362),i=n(137),s=n(185),o=n(410);r(r.S,"Object",{getOwnPropertyDescriptors:function(e){for(var t,n,r=i(e),c=s.f,l=a(r),u={},d=0;l.length>d;)void 0!==(n=c(r,t=l[d++]))&&o(u,t,n);return u}})},362:function(e,t,n){var r=n(380),a=n(364),i=n(135),s=n(100).Reflect;e.exports=s&&s.ownKeys||function(e){var t=r.f(i(e)),n=a.f;return n?t.concat(n(e)):t}},363:function(e,t,n){n(409),e.exports=n(51).Object.getOwnPropertySymbols},376:function(e,t,n){var r=n(691),a=n(694),i=n(698),s=n(699);e.exports=function(e){return r(e)||a(e)||i(e)||s()}},39:function(e,t,n){var r=n(130);e.exports=function(e,t,n){return t in e?r(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},47:function(e,t,n){e.exports=n(667)},565:function(e,t){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}},667:function(e,t,n){n(668),e.exports=n(51).Object.keys},668:function(e,t,n){var r=n(378),a=n(379);n(357)("keys",(function(){return function(e){return a(r(e))}}))},691:function(e,t,n){var r=n(84),a=n(565);e.exports=function(e){if(r(e))return a(e)}},692:function(e,t,n){n(693),e.exports=n(51).Array.isArray},693:function(e,t,n){var r=n(76);r(r.S,"Array",{isArray:n(563)})},694:function(e,t,n){var r=n(142),a=n(696),i=n(196);e.exports=function(e){if(void 0!==i&&a(Object(e)))return r(e)}},696:function(e,t,n){e.exports=n(570)},698:function(e,t,n){var r=n(142),a=n(565);e.exports=function(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?r(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}},699:function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},74:function(e,t,n){e.exports=n(224)},81:function(e,t,n){e.exports=n(360)},82:function(e,t,n){e.exports=n(363)},84:function(e,t,n){e.exports=n(692)}}]);